---
title: ASP.NET MVC统一异常处理
id: 422
categories:
  - ASP.NET
  - 'C#'
  - MVC
  - WEB开发
date: 2014-02-12 14:40:10
tags:
---

## 前言：

今早看了篇文章：[求知成瘾，却无作品 的思考](http://www.cnblogs.com/stoneniqiu/p/3545230.html)；很有感触，发现原来自己也是这样，对每样东西都抱有很大的兴趣或者希望自己去学，一年后发现原来自己什么都是皮毛什么都不精！最终发现真正的大牛都是在某一个领域的大牛，不会是全能的。所以是时候精一下了。

本篇文章来源于今天的另外一篇阅读：《我的软件没bug》作者希望读者写的程序即使已经上线也能快速的发现自己bug而不是等着用户忍无可忍时的反馈，这样让用户产生错觉是其用的软件并没有bug，而能实现这些最关键的一点就是能不能发现bug。所以小猪今天写了其实已经关注非常久的一个主题：统一的异常处理

## 实现

ASP.NET MVC提供了很方便的实现处理异常的机制：在需要进行异常处理的Controller中重写OnException。如果整个程序都需要异常处理，可以先写一个BaseController，其他所有Controller都继承它，然后在BaseController中重写OnException。
然后让自己的Controller继承自这个BaseController即可。

另外如果只是针对某一个Action的捕获异常则可以写一个Attribute继承自HandleErrorAttribute：

## 存数据库还是文件

细心的读者可能发现上述的代码小猪是保存在网站跟文件夹下的一个文件里的。这里涉及到把异常数据保存在什么地方的问题。有两种选择数据库和文件。但是小猪考虑到存数据库时存在一个问题：当数据库无法链接时网站也是会报错，这个时候的错误如果是采用存在数据库的机制的话则无法记录，而存在文件里则不存在这个问题，除非是web服务器奔了。综上原因小猪采取了把日志文件存放在文件里的方法。