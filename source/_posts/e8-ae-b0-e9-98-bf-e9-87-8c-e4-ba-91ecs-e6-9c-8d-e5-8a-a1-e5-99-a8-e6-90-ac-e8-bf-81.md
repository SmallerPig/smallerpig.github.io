---
title: 记阿里云ECS服务器搬迁
tags:
  - 阿里云
id: 893
categories:
  - WEB开发
date: 2015-09-16 14:45:10
---

之前一直使用的是其他账号购买的公司服务器,但是这个其他账号因为开过了别的公司的发票,而现在阿里云的发票一个账号只能对应一个抬头,修改起来非常麻烦,所以只能单独申请一个账号来购买服务器了.正好赶上最近搞活动,经过企业认证的账号购买第一台服务器半价.果断准备这件事.

首先我想吐槽下阿里云的这次活动,明明说的是第一台半价,我想有这好事为什么不能多买几年,反正这玩意肯定是要买的.结果操作的时候才发现人家最多只让你买一年,超过一年的话连第一年都给你按照原价算.这算不算是欺骗消费者,在线等…挺急的…

整个搬迁过程中最关键的就是得保证数据不能丢失,这里再吐槽一下阿里云的ECS服务器不能账号间转移!如果可以像域名一样直接将产品转移到其他账户下的话也就不会这么多事了.不过那样的话我们就享受不到企业认证之后第一台半价的优惠了,O(∩_∩)O.

为了保证数据不丢失,我也是操碎了这颗玻璃心,咨询客服之后发现可以进行镜像分享的操作达到目的!.那真是太好了.这里再赞一下阿里云的客服.提交工单之后很快给出回应,在文字沟通不顺利的情况下还直接打电话过来沟通,包括上次小猪的域名备案过程中.有什么问题直接提交工单,客服都会很认真的对问题进行解答.

附上与客服的记录:

[](http://www.smallerpig.com/wp-content/uploads/2015/09/VVA9B1P7QKU7FWUK3EO_thumb.png)

然后就是将原来的服务器的数据盘的数据都复制到系统盘,然后登陆阿里云后台制作镜像,分享给新的阿里云账号,新的阿里云账号创建ECS实例,创建时系统选择分享的镜像,然后付钱,进入新的服务器,.哎呀妈呀,一整个服务器和原来的一模一样啊.连之前没删掉的百度云关键都在呢,真是贴心.这样确实是省了很多事.一些基础的软件例如IIS SQLSERVER FTP等软件不需要安装不说,最关键的是我们之前的网站数据也可以完全的克隆过来.整个过程体验我给阿里云95分.还有5分不是对他不满意,而是希望继续给我们惊喜!

最后的问题就是数据库的问题了.因为当初在复制数据的时候mdf文件没有直接复制过来(没有挺掉数据库服务而无法复制),然后打开新服务器对应的库就是”恢复挂起”的状态.原因我猜就是因为找不到对应的Mdf文件.这时候只好手动将原服务器的mdf文件都下载到新服务器并放到对应的文件夹下,然后到网上找解决方法,看到[这里](http://bbs.csdn.net/topics/390702507)说的可以使用sql语句:
``` 
alter database dbname
set online 

```
来让对应的库恢复,可是我执行了该语句之后却给我了个错误:
```
消息 5120，级别 16，状态 101，第 1 行
无法打开物理文件“D:\www\Movies\Movies.mdf”。操作系统错误 5:“5(拒绝访问。)”。
消息 5120，级别 16，状态 101，第 1 行
无法打开物理文件“D:\www\Movies\Movies_log.ldf”。操作系统错误 5:“5(拒绝访问。)”。
消息 5181，级别 16，状态 5，第 1 行
无法重新启动数据库“Movies”。将恢复到以前的状态。
消息 5069，级别 16，状态 1，第 1 行
ALTER DATABASE 语句失败。


 
```
最后删除原来的库,使用SQL SERVER的附加数据库功能将mdf文件附加到服务器中.这样整个迁移过程就完成了.

接下来需要做的就是把对应的域名解析到新的服务器上面咯.!